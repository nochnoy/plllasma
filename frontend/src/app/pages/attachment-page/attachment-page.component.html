@if (isLoading) {
  <div class="spinner"></div>
} @else {
  @if (error) {
    <div class="error">
      <div>üôÅ</div>
      <div>{{error}}</div>
    </div>
  } @else {
      @if (attachment) {
      @if (!isImageMagnified) {
        <div class="attachment">

          @switch (attachment.type) {

            @case ('image') {

              <h2>{{attachment.filename}}</h2>

              @if (!isImageMagnified) {
                <img
                  class="image stage"
                  [src]="getAttachmentImageUrl()"
                  [alt]="attachment.filename || ''"
                  (click)="isImageMagnified = true"
                  (contextmenu)="$event.preventDefault(); $event.stopPropagation(); downloadFile();"
                />
              }
            }

            @case ('video') {

              <h2>{{attachment.filename}}</h2>

              @if (attachment.file) {
                @if (canPlayVideo()) {
                  <div class="video">
                    <video
                      class="stage content-normal video"
                      (contextmenu)="$event.preventDefault(); $event.stopPropagation();"
                      [src]="getAttachmentImageUrl()"
                      [muted]="'muted'"
                      controls
                      loop
                      autoplay
                    >
                    </video>
                  </div>

                }
              } @else {
                <div class="unloaded">
                  üôÅ –§–∞–π–ª –±—ã–ª –≤—ã–≥—Ä—É–∂–µ–Ω –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
                </div>
              }
            }

            @case ('youtube') {

              <a [href]="attachment.source" class="source">
                {{attachment.source}}
              </a>

              <h2>{{attachment.title}}</h2>

              @if (getYouTubeVideoId()) {
                <div class="youtube">
                  <iframe
                    class="stage youtube-player"
                    [src]="getYouTubeEmbedUrl() | safe: 'resourceUrl'"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                  ></iframe>
                </div>
              }
            }

          }

          @if (attachment.type !== 'youtube') {
            @if (attachment.file) {
              <button
                (click)="downloadFile()"
                class="download"
              >
                –°–∫–∞—á–∞—Ç—å {{getFileSize()}}
              </button>
            } @else {
              <div class="unloaded">
                üôÅ –§–∞–π–ª –±—ã–ª –≤—ã–≥—Ä—É–∂–µ–Ω –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
              </div>
            }
          }

          @if (canModerate() && attachment.file && !attachment.s3) {
            <button
              (click)="onS3MigrationClick()"
              style="margin-top: 10px;"
            >
              –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ S3
            </button>
          }

          <div class="info">
            @if (attachment.type !== 'youtube') {
              <div>–°–∫–∞—á–∞–ª–∏ {{attachment.downloads}}</div>
            }
            <div>–°–º–æ—Ç—Ä–µ–ª–∏ {{attachment.views}}</div>
            @if (attachment.type === 'youtube' && attachment.duration) {
              <div>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å {{formatDuration(attachment.duration)}}</div>
            }
          </div>

          @if (attachment.preview) {
            <img [src]="getPreviewUrl()">
          }

        </div>

      } @else {

        <!-- –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞-->
        <img
          class="image-magnified"
          [src]="getAttachmentImageUrl()"
          [alt]="attachment.filename || ''"
          (click)="isImageMagnified = false"
          (contextmenu)="$event.preventDefault(); $event.stopPropagation(); downloadFile();"
        />

      }
    }
  }
}

