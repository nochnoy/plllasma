@if (isLoading) {
  <div class="spinner"></div>
} @else {
  @if (error) {
    <div class="error">
      <div>üôÅ</div>
      <div>{{error}}</div>
    </div>
  } @else {
    @if (attachment) {

      <div class="info" (click)="isInfoExpanded = !isInfoExpanded">
        <div
          class="info-button"
          [class.up]="isInfoExpanded"
          [class.down]="!isInfoExpanded"
        ></div>
        <div>
          @if (isInfoExpanded) {
            <span class="file-name">{{attachment.filename}}</span><br>
            <br>
            –†–∞–∑–º–µ—Ä: <b>{{ getFileSize() }}</b><br>
            –°–º–æ—Ç—Ä–µ–ª–∏: <b>{{attachment.views}}</b><br>
            –°–∫–∞—á–∞–ª–∏: <b>{{attachment.downloads}}</b><br>
            <br>
            @if (attachment.preview) {
              <a [href]="getPreviewUrl()">–°–∫—Ä–∏–Ω—à–æ—Ç—ã</a><br>
            }
          }
          @if (attachment.file) {
            <a href (click)="$event.preventDefault(); $event.stopImmediatePropagation(); downloadFile(); isInfoExpanded = true;">–°–∫–∞—á–∞—Ç—å</a>
          } @else {
            –ù–µ —Å–∫–∞—á–∞—Ç—å :(
          }
        </div>
      </div>

      @switch (attachment.type) {

        @case ('image') {
          <img
            class="image shadow"
            [src]="getAttachmentImageUrl()"
            [alt]="attachment.filename || ''"
            [class.content-normal]="!isImageMagnified"
            [class.content-zoomed]="isImageMagnified"
            (click)="isImageMagnified = !isImageMagnified"
            (contextmenu)="$event.preventDefault(); $event.stopPropagation();"
          />
        }

        @case ('video') {
          @if (attachment.file) {
            @if (canPlayVideo()) {
              <div class="video shadow">
                <video
                  class="content-normal video"
                  (contextmenu)="$event.preventDefault(); $event.stopPropagation();"
                  [src]="getAttachmentImageUrl()"
                  [muted]="'muted'"
                  controls
                  loop
                  autoplay
                >
                </video>
              </div>
            } @else {
              <div class="file">
                <h1>{{attachment.filename}}</h1>
                <button class="button" (click)="downloadFile()">–°–∫–∞—á–∞—Ç—å {{ getFileSize() }}</button>
                @if (attachment.preview) {
                  <div style="margin-top: 1rem">
                    <img
                      [src]="getPreviewUrl()"
                      [alt]="attachment.filename || ''"
                    >
                  </div>
                }
              </div>
            }
          } @else {
            <div class="video-unloaded">

              <h1 class="file-name">{{attachment.filename}}</h1>
              –§–∞–π–ª –±—ã–ª –≤—ã–≥—Ä—É–∂–µ–Ω –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
              @if (attachment.preview) {
                <img
                  [src]="getPreviewUrl()"
                  [alt]="attachment.filename || ''"
                >
              }
            </div>
          }
        }

        @case ('file') {
          <div class="file">
            <h1>{{attachment.filename}}</h1>
            <button class="download-button" (click)="downloadFile()">–°–∫–∞—á–∞—Ç—å {{ getFileSize() }}</button>
          </div>
        }
      }

    }
  }
}

