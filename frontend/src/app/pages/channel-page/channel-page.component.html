<div class="three-column-page">
  <aside class="aside">
      <app-main-menu (itemClick)="onMenuItemClick($event)"></app-main-menu>
  </aside>
  <main class="main" *ngIf="channel && !channel.canAccess">
    <div class="general-error">
      üòé –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª
    </div>
  </main>
  <main class="main" *ngIf="!channel || channel?.canAccess">
    <ng-container *ngIf="channel && channel?.canAccess">

      <div class="channel-top-bar">
        <div class="channel-title">
          {{channel.name}}
          <div *ngIf="channel?.isLoading" class="spinner"></div>
        </div>
        <div
          *ngIf="!channel?.isLoading && channel?.id !== 1"
          class="channel-stats"
          title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π, –¥–æ–±–∞–≤–∏–≤—à–∏—Ö —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª –≤ —Å–≤–æ—ë –±–æ–∫–æ–≤–æ–µ –º–µ–Ω—é"
        >
          {{channel?.statSubscribers}} –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
        </div>
      </div>

      <app-matrix #matrix
        [channel]="channel!"
        (change)="onMatrixChanged($event)">
      </app-matrix>

      <div class="form">
        <app-message-form class="form-content" [channelId]="channelId" (onPost)="onNewMessageCreated()"></app-message-form>

        <div class="form-tools" *ngIf="!channel?.isLoading">
          <ng-container *ngIf="channel?.id !== 1">
            <div><b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–º</b></div>
            <div (click)="subscribeCommand()" *ngIf="!channel?.atMenu" class="pseudo-link"><i>‚≠ê</i> –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</div>
            <div (click)="unsubscribeCommand()" *ngIf="channel?.atMenu" class="pseudo-link"><i>‚úñ</i> –û—Ç–ø–∏—Å–∞—Ç—å—Å—è</div>

            <ng-container *ngIf="!channel?.atMenu">
              <div (click)="ignoreCommand()" *ngIf="!channel?.isIgnoring" class="pseudo-link"><i>üéß</i> –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å</div>
              <div (click)="unignoreCommand()" *ngIf="channel?.isIgnoring" class="pseudo-link"><i>üé∏</i> –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å</div>
            </ng-container>

            <div class="channel-tools">
              <div *ngIf="channel?.canUseSettings" [matMenuTriggerFor]="menu" class="pseudo-link">üíº –ù–∞—Å—Ç—Ä–æ–π–∫–∏ <span class="up-down">‚ñæ</span></div>
              <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="matrix.addImageCommand()">–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞</button>
                  <button mat-menu-item (click)="matrix.addImageCommand()">–î–∏–∑–∞–π–Ω: –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É</button>
                  <button mat-menu-item (click)="matrix.addTextCommand()">–î–∏–∑–∞–π–Ω: –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç</button>
                  <button mat-menu-item (click)="matrix.addTitleCommand()">–î–∏–∑–∞–π–Ω: –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫</button>
                  <button mat-menu-item (click)="matrix.clearCommand()">–û—á–∏—Å—Ç–∏—Ç—å –¥–∏–∑–∞–π–Ω</button>
              </mat-menu>
            </div>

          </ng-container>
        </div>
      </div>

      <div *ngIf="channel?.isIgnoring" class="ignoring">
        <div>üéß</div>
        <div><b>–í—ã –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç–µ —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª</b></div>
        <div>–ù–∞ –Ω—ë–º –Ω–µ –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –∫—Ä–∞—Å–Ω—ã–µ –∑–Ω–∞—á–∫–∏, —Ç–∞–∫ —á—Ç–æ –≤—ã –Ω–µ —É–∑–Ω–∞–µ—Ç–µ –æ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∑–¥–µ—Å—å –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</div>
      </div>

      <div *ngIf="!!channel" class="messages">
        <div class="thread" [class.thread-gray]="t.isGray" *ngFor="let t of channel.threads">
          <app-messages
            [placeId]="channelId"
            [canModerate]="channel?.canModerate ?? false"
            [messages]="[t.root]"
            [showChildren]="t.isGray || t.isExpanded">
          </app-messages>
          <div class="branch" *ngIf="t.commentsCount > 0 && !(t.isGray || t.isExpanded)" (click)="onExpandClick($event, t)">
            <a class="expand" [class.spinner]="isExpanding === t" href >{{t.commentsCountText}}</a>
          </div>
        </div>
      </div>

      <div class="paginator">
        <a *ngFor="let page of pagesToShow"
           href
           [class.current]="page === currentPage"
           (click)="onPagination($event, page)">
          {{page + 1}}
        </a>
      </div>

    </ng-container>
  </main>
  <div class="sidebar" [class.sidebar-halloween]="isHalloween" [class.sidebar-newyear]="isNewYear">

    <app-newyear *ngIf="isNewYear"></app-newyear>

    <div class="halloween" *ngIf="isHalloween">
      <img src="assets/img/halloween-pumpkin.png">
    </div>

    <div class="content">

      <div class="mail-notification" *ngIf="mailNotification?.message">
        <a [routerLink]="'/members/' + mailNotification?.nick">
          <div class="newmail-icon"></div>
          <b>{{mailNotification?.nick}}</b>
          <span>{{mailNotification?.message}}</span>
        </a>
      </div>

      <div class="now-here" *ngIf="hereAndNowUsers.length">
        <div class="nowandhere-label">–ó–¥–µ—Å—å —Å–µ–π—á–∞—Å</div>
        <a *ngFor="let user of hereAndNowUsers; let i = index;"
           [routerLink]="'/members/' + user"
           target="_blank"
           class="nowandhere-user">
          {{user}}
        </a>
      </div>

      <div *ngIf="isNotificationsReady && !(mailNotification?.message || hereAndNowUsers.length)">
        –Ω–∏–∫–æ–≥–æ –Ω–µ—Ç
      </div>

    </div>

  </div>
</div>
