<div class="three-column-page">
  <aside class="aside">
      <app-main-menu (itemClick)="onMenuItemClick(channel)"></app-main-menu>
  </aside>
  <main class="main">
    <div class="general-error" *ngIf="channel && !canAccess">
      üîí –£ –≤–∞—Å –Ω–µ—Ç —Å—é–¥–∞ –¥–æ—Å—Ç—É–ø–∞
    </div>
    <ng-container *ngIf="channel && canAccess">

      <app-matrix #matrix
        [channel]="channelModel!"
        (changed)="onMatrixChanged($event)">
      </app-matrix>

      <div class="form">
        <app-message-form-2 class="form-content" [channelId]="channel.id_place" (onPost)="onNewMessageCreated()"></app-message-form-2>
        <div *ngIf="channel.spinner" class="loading" [class.spinner]="channel.spinner">–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è</div>
        <div *ngIf="!channel.spinner" class="form-tools">
          <!--

          -->
          <button mat-button [matMenuTriggerFor]="menu">üé® –î–∏–∑–∞–π–Ω–∏—Ç—å –∫–∞–Ω–∞–ª ‚ñæ</button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item [disabled]="!canEditMatrix" (click)="matrix.addImageCommand()">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏</button>
            <button mat-menu-item [disabled]="!canEditMatrix" (click)="matrix.addTextCommand()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç - –æ–±—ã—á–Ω–π</button>
            <button mat-menu-item [disabled]="!canEditMatrix" (click)="matrix.addTitleCommand()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç - –∫—Ä—É–ø–Ω—ã–π</button>
            <button mat-menu-item [disabled]="!canEditMatrix" (click)="matrix.addChannelTitleCommand()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç - –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞–Ω–∞–ª–∞</button>
            <button mat-menu-item [disabled]="!canEditMatrix" (click)="matrix.clearCommand()">–û—á–∏—Å—Ç–∏—Ç—å –¥–∏–∑–∞–π–Ω</button>
            <!--
            <button mat-menu-item (click)="onAddMatrixDoor()">–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞–Ω–∞–ª</button>
            <button mat-menu-item (click)="openDialog()">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞</button>
            -->
          </mat-menu>
          <button mat-button [disabled]="!canUseSettings">üî® –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
          <button mat-button>üíº –û –∫–∞–Ω–∞–ª–µ</button>
          <div>–í—ã {{roleTitle}} –∫–∞–Ω–∞–ª–∞</div>

        </div>
      </div>

      <div *ngIf="!!channelModel" class="messages">
        <div class="thread" [class.thread-gray]="t.isGray" *ngFor="let t of channelModel.threads">
          <app-messages
            [placeId]="channel.id_place"
            [canModerate]="channel.canModerate"
            [messages]="[t.root]"
            [showChildren]="t.isGray || t.isExpanded">
          </app-messages>
          <div class="branch" *ngIf="t.commentsCount > 0 && !(t.isGray || t.isExpanded)" (click)="onExpandClick($event, t)">
            <a class="expand" [class.spinner]="isExpanding === t" href >{{t.commentsCountText}}</a>
          </div>
        </div>
      </div>

      <div class="paginator">
        <a *ngFor="let page of pagesToShow"
           href
           [class.current]="page === currentPage"
           (click)="onPagination($event, page)">
          {{page + 1}}
        </a>
      </div>

    </ng-container>
  </main>
  <div class="sidebar">

    <div class="mail-notification" *ngIf="mailNotification?.message">
      <a [routerLink]="'/members/' + mailNotification?.nick">
        <div class="newmail-icon"></div>
        <b>{{mailNotification?.nick}}</b>
        <span>{{mailNotification?.message}}</span>
      </a>
    </div>

    <ng-container *ngIf="channel.id_place === 1">
      <img class="banner" src="assets/img/halloween.png">
    </ng-container>

    <div class="now-here" *ngIf="hereAndNowUsers.length">
      <div class="nowandhere-label">–ó–¥–µ—Å—å —Å–µ–π—á–∞—Å:</div>
      <a *ngFor="let user of hereAndNowUsers; let i = index;"
         [routerLink]="'/members/' + user"
         target="_blank"
         class="nowandhere-user">
        {{user}}
      </a>
    </div>

    <div class="nothing" *ngIf="isNotificationsReady && !(mailNotification?.message || hereAndNowUsers.length)">–Ω–∏–∫–æ–≥–æ –Ω–µ—Ç</div>

  </div>
</div>
