<div class="three-column-page">
  <aside class="aside">
      <app-main-menu (itemClick)="onMenuItemClick($event)"></app-main-menu>
  </aside>
  <main class="main" *ngIf="channel && !channel.canAccess">
    <div class="general-error">
      üòé –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª
    </div>
  </main>
  <main class="main" *ngIf="!channel || channel?.canAccess">
    <ng-container *ngIf="channel && channel?.canAccess">

      <app-matrix #matrix
        [channel]="channel!"
        (change)="onMatrixChanged($event)">
      </app-matrix>

      <div class="form">
        <app-message-form-2 class="form-content" [channelId]="channelId" (onPost)="onNewMessageCreated()"></app-message-form-2>
        <div class="form-tools" *ngIf="!channel?.isLoading">

          <button mat-button [matMenuTriggerFor]="menu" *ngIf="channel?.canEditMatrix"><i>üé®</i> –î–∏–∑–∞–π–Ω–∏—Ç—å ‚ñæ</button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="matrix.addImageCommand()">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏</button>
            <button mat-menu-item (click)="matrix.addTextCommand()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç - –æ–±—ã—á–Ω–π</button>
            <button mat-menu-item (click)="matrix.addTitleCommand()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç - –∫—Ä—É–ø–Ω—ã–π</button>
            <button mat-menu-item (click)="matrix.clearCommand()">–û—á–∏—Å—Ç–∏—Ç—å –¥–∏–∑–∞–π–Ω</button>
            <!--
            <button mat-menu-item (click)="onAddMatrixDoor()">–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞–Ω–∞–ª</button>
            <button mat-menu-item (click)="openDialog()">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞</button>
            -->
          </mat-menu>
          <ng-container *ngIf="channel?.id !== 1">
            <button mat-button (click)="subscribeCommand()" *ngIf="!channel?.atMenu"><i>üì™</i> –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª</button>
            <button mat-button (click)="ubsubscribeCommand()" *ngIf="channel?.atMenu"><i>üì´</i> –û—Ç–ø–∏—Å–∞—Ç—å—Å—è</button>
          </ng-container>

          <!--
          <button mat-button [disabled]="channel?.canUseSettings">üî® –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
          <button mat-button>üíº –û –∫–∞–Ω–∞–ª–µ</button>
          <div>–í—ã {{channel?.roleTitle}} –∫–∞–Ω–∞–ª–∞</div>
          -->

        </div>
      </div>

      <div *ngIf="!!channel" class="messages">
        <div class="thread" [class.thread-gray]="t.isGray" *ngFor="let t of channel.threads">
          <app-messages
            [placeId]="channelId"
            [canModerate]="channel?.canModerate ?? false"
            [messages]="[t.root]"
            [showChildren]="t.isGray || t.isExpanded">
          </app-messages>
          <div class="branch" *ngIf="t.commentsCount > 0 && !(t.isGray || t.isExpanded)" (click)="onExpandClick($event, t)">
            <a class="expand" [class.spinner]="isExpanding === t" href >{{t.commentsCountText}}</a>
          </div>
        </div>
      </div>

      <div class="paginator">
        <a *ngFor="let page of pagesToShow"
           href
           [class.current]="page === currentPage"
           (click)="onPagination($event, page)">
          {{page + 1}}
        </a>
      </div>

    </ng-container>
  </main>
  <div class="sidebar" [class.sidebar-halloween]="isHalloween">

    <div class="halloween" *ngIf="isHalloween">
      <ng-container *ngIf="currentYear === 2023">
        –ö–æ–Ω–µ—Ü –±–ª–∏–∑–æ–∫! –ö–∞–Ω–∞–ª—ã –º—É—Ç–∏—Ä—É—é—Ç.
        –°–∫–æ—Ä–æ –æ–Ω–∏ –Ω–∞—á–Ω—É—Ç —Ä–∞–∑–º–Ω–æ–∂–∞—Ç—å—Å—è
        –∏ –∏—Ö —Å—Ç–∞–Ω–µ—Ç —Å—Ç–æ–ª—å–∫–æ, —á—Ç–æ –º—ã –≤—Å–µ —É–º—Ä—ë–º!
        –ò&nbsp;—á–µ—Ä–≤–∏ —Å—ä–µ–¥—è—Ç –Ω–∞—à–∏ –≥–ª–∞–∑–∞!<br>
      </ng-container>
      <img src="assets/img/halloween-pumpkin.png">
    </div>

    <div class="mail-notification" *ngIf="mailNotification?.message">
      <a [routerLink]="'/members/' + mailNotification?.nick">
        <div class="newmail-icon"></div>
        <b>{{mailNotification?.nick}}</b>
        <span>{{mailNotification?.message}}</span>
      </a>
    </div>

    <div class="now-here" *ngIf="hereAndNowUsers.length">
      <div class="nowandhere-label">–ó–¥–µ—Å—å —Å–µ–π—á–∞—Å:</div>
      <a *ngFor="let user of hereAndNowUsers; let i = index;"
         [routerLink]="'/members/' + user"
         target="_blank"
         class="nowandhere-user">
        {{user}}
      </a>
    </div>

    <div class="nothing" *ngIf="isNotificationsReady && !(mailNotification?.message || hereAndNowUsers.length)">–Ω–∏–∫–æ–≥–æ –Ω–µ—Ç</div>

  </div>
</div>
