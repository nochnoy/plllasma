<div class="three-column-page">
  <aside class="aside">
      <app-main-menu (itemClick)="onMenuItemClick(channel)"></app-main-menu>
  </aside>
  <main class="main">
    <ng-container *ngIf="channel">
      <header>
        <h1 [class.spinner]="channel.spinner">{{channel.name}}</h1>
        <div *ngIf="channelModel?.id === 12">
          <!--
          <button mat-button>üíº –û –∫–∞–Ω–∞–ª–µ</button>
          <button mat-button>üî® –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–Ω–∞–ª</button>
          -->
          <button mat-button [matMenuTriggerFor]="menu">üé® –î–∏–∑–∞–π–Ω–∏—Ç—å ‚ñæ</button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="matrix.addImageCommand()">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É</button>
            <button mat-menu-item (click)="matrix.addImageCommand()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç</button>
            <button mat-menu-item (click)="matrix.clearCommand()">–û—á–∏—Å—Ç–∏—Ç—å</button>
            <!--
            <button mat-menu-item (click)="onAddMatrixDoor()">–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞–Ω–∞–ª</button>
            <button mat-menu-item (click)="openDialog()">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞</button>
            -->
          </mat-menu>
        </div>
      </header>

      <app-matrix #matrix
        [channel]="channelModel!"
        (changed)="onMatrixChanged()">
      </app-matrix>

      <div class="form">
        <app-message-form-2 class="form-content" [channelId]="channel.id_place" (onPost)="onNewMessageCreated()"></app-message-form-2>
      </div>

      <div *ngIf="!!channelModel" class="messages">
        <div class="thread" [class.thread-gray]="t.isGray" *ngFor="let t of channelModel.threads">
          <app-messages
            [placeId]="channel.id_place"
            [canModerate]="channel.canModerate"
            [messages]="[t.root]"
            [showChildren]="t.isGray || t.isExpanded">
          </app-messages>
          <div class="branch" *ngIf="t.commentsCount > 0 && !(t.isGray || t.isExpanded)" (click)="onExpandClick($event, t)">
            <a class="expand" [class.spinner]="isExpanding === t" href >{{t.commentsCountText}}</a>
          </div>
        </div>
      </div>

      <div class="paginator">
        <a *ngFor="let page of pagesToShow"
           href
           [class.current]="page === currentPage"
           (click)="onPagination($event, page)">
          {{page + 1}}
        </a>
      </div>

    </ng-container>
  </main>
  <div class="sidebar">

    <div class="mail-notification" *ngIf="mailNotification?.message">
      <a [routerLink]="'/members/' + mailNotification?.nick">
        <div class="newmail-icon"></div>
        <b>{{mailNotification?.nick}}</b>
        <span>{{mailNotification?.message}}</span>
      </a>
    </div>

    <div class="now-here" *ngIf="hereAndNowUsers.length">
      <div class="nowandhere-label">–ó–¥–µ—Å—å —Å–µ–π—á–∞—Å:</div>
      <a *ngFor="let user of hereAndNowUsers; let i = index;"
         [routerLink]="'/members/' + user"
         target="_blank"
         class="nowandhere-user">
        {{user}}
      </a>
    </div>

    <div class="nothing" *ngIf="isNotificationsReady && !(mailNotification?.message || hereAndNowUsers.length)">–Ω–∏–∫–æ–≥–æ –Ω–µ—Ç</div>

    <!--
    <img class="banner" src="assets/img/newyear2024.png">
    -->

  </div>
</div>
