<ng-container *ngFor="let message of messages">
  <div class="message"
       [class.msg-root]="!message.parent"
       [class.msg-starred]="message.isStarred"
       *ngIf="message != null">

    <ng-container [ngSwitch]="message.display">

      <!-- –û–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (MessageDisplayType.NORMAL) -->
      <ng-container *ngSwitchCase="0">
        <div class="message-content"
             [class.message-content__selected]="message === channelService.selectedMessage"
             (click)="onMessageClick(message)">
          <img class="avatar" [src]="'https://plllasma.com/i/' + message.icon +'.gif'" />
          <b [class.star]="message.isStarred">{{message.nick}}</b><br>
          <div class="message-text" *ngIf="!!message.text" [innerHTML]="message.text | linky | newline"></div>

          <ng-container *ngIf="message.attachments">
            <a *ngFor="let attachment of message.attachments"
               class="att" target="_blank"
               [href]="'../api/file.php?p=' + this.placeId + '&m=' + this.message.id + '&a=' + attachment.id">
              <img [src]="'../api/i.php?p=' + this.placeId + '&m=' + this.message.id + '&a=' + attachment.id" loading="lazy" />
            </a>
          </ng-container>

          <div class="message-likes" *ngIf="message === channelService.selectedMessage">
            <div><a href (click)="onReplyClick($event)">{{this.isReplyMode ? '–û—Ç–º–µ–Ω–∏—Ç—å' : '–û—Ç–≤–µ—Ç–∏—Ç—å'}}</a></div>
            <div><a href (click)="onLikeClick($event, '')">üëç</a> 99</div>
            <div><a href (click)="onLikeClick($event, '')">üòÑ</a> 99</div>
            <div><a href (click)="onLikeClick($event, '')">ü§î</a> 99</div>
            <div><a href (click)="onLikeClick($event, '')">üòµ</a> 99</div>
          </div>

          <div class="message-reply-form" *ngIf="message === channelService.selectedMessage && this.isReplyMode">
            <app-message-form [channelId]="placeId" [parentMessage]="message"
                              (onPost)="onNewMessageCreated()">
            </app-message-form>
          </div>

        </div>

      </ng-container>

      <!-- –°–µ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (MessageDisplayType.GRAY) -->
      <ng-container *ngSwitchCase="1">
        <div class="text text-gray" (click)="unfoldGray($event, message)">
          <img class="avatar" [src]="'https://plllasma.com/i/' + message.icon +'.gif'">
          <b [class.star]="message.isStarred">{{message.nick}}</b><br>
          <span *ngIf="!!message.text" [innerHTML]="message.text | linky | newline"></span>
        </div>
        <ng-container *ngIf="message.attachments">
          <a *ngFor="let attachment of message.attachments"
             class="att" target="_blank"
             [href]="'../api/file.php?p=' + this.placeId + '&m=' + this.message.id + '&a=' + attachment.id">
            <img [src]="'../api/i.php?p=' + this.placeId + '&m=' + this.message.id + '&a=' + attachment.id" loading="lazy" />
          </a>
        </ng-container>
      </ng-container>

      <ng-container *ngSwitchCase="10">
        <div class="text text-gray" (click)="unshlop($event, message)">
          {{(message | as : ShlopMessageRef).shlop.lengthText}}
        </div>
      </ng-container>

    </ng-container>

    <app-messages *ngIf="showChildren && message.children && message.children.length > 0" [placeId]="placeId" [messages]="message.children"></app-messages>

  </div>
</ng-container>
